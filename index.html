<!doctype html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>お問い合わせフォーム</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
    <body>
        <form id="inquiryForm" size="5">
            <div>
                ご用件
                <select name="classification" id="classification">
                    <option value="ATMについて">ATMについて</option>
                    <option value="キャッシュカード・トークンについて">キャッシュカード・トークンについて</option>
                    <option value="ログインパスワード・暗証番号・不明・変更について">ログインパスワード・暗証番号・不明・変更について</option>
                    <option value="Visaデビットについて">Visaデビットについて</option>
                    <option value="ローン・住宅ローンについて">ローン・住宅ローンについて</option>
                    <option value="口座開設・口座利用開始について">口座開設・口座利用開始について</option>
                    <option value="FX・投信・外貨預金について">FX・投信・外貨預金について</option>
                    <option value="登録情報変更　住所変更等について">登録情報変更　住所変更等について</option>
                    <option value="明細・振込・振替等について">明細・振込・振替等について</option>
                    <option value="その他お問い合わせ">その他お問い合わせ</option>
                </select>
            </div>
            <div>
                お問い合わせ内容
                <textarea name="inquiry" id="inquiry" rows="50" cols="80"></textarea><br>
            </div>
            <input type="button" onclick="send()" value="送信">
        </form>
        </br>
        <div>過去のお問い合わせ内容</div>
        <div id="pastInquiry"></div>
    </body>
</html>
<script type="text/javascript">
    // 初期表示処理
    window.onload = function(){
        // GETメソッド呼び出し
        var xmlHttpRequest = new XMLHttpRequest();
        xmlHttpRequest.onreadystatechange = function(){
            if(this.readyState == 4 && this.status == 200){
                var res = JSON.parse(this.responseText);
                if(res.length != 0){
                    for (var i = 0; i < res.length; i++) {
                        document.getElementById('pastInquiry').innerHTML += res[i].Inquiry__c + '<br>';
                    }
                }
            }
        }
        xmlHttpRequest.open( 'GET', 'https://protocomdev-dev-ed.my.salesforce.com/services/apexrest/PPB_Inquiry__c/A0000001');
        xmlHttpRequest.setRequestHeader( 'Authorization', 'Bearer 00D5j00000BXmyf!ARUAQIl9xYTMOxAEuy39t2eRwYR59kxGZTWZwbq8QxFNb.DJ8ljDk2UTfSWkBjH8FJe5LCBu4JHoWBAe6BE29zxfzPV9DPhn');
        xmlHttpRequest.send();

    }

    function send() {
        // ご用件を取得
        const classificationValue = document.getElementById("classification").value;

        // お問い合わせ内容を取得
        const inquiryValue = document.getElementById("inquiry").value;

        var inputData = {};

        inputData.AccountNumber = 'A0000001';
        inputData.Classification = classificationValue;
        inputData.Inquiry = inquiryValue;

        // Rest ApexへパラメータをJSON形式に変換
        data = JSON.stringify( inputData );

        var xmlHttpRequest = new XMLHttpRequest();
        xmlHttpRequest.onreadystatechange = function()
        {
            if(this.readyState == 4 && this.status == 200){
                var res = JSON.parse(this.responseText);
                if(res.length != 0){
                    document.getElementById('pastInquiry').innerHTML = "";
                    for (var i = 0; i < res.length; i++) {
                        var formElement = document.getElementById('inquiryForm');
                        formElement.reset();
                        document.getElementById('pastInquiry').innerHTML += res[i].Inquiry__c + '<br>';
                    }
                }
            }
        }
        xmlHttpRequest.open( 'POST', 'https://protocomdev-dev-ed.my.salesforce.com/services/apexrest/PPB_Inquiry__c/');
        // サーバに対して解析方法を指定する
        xmlHttpRequest.setRequestHeader( 'Content-Type', 'application/json');
        xmlHttpRequest.setRequestHeader( 'Authorization', 'Bearer 00D5j00000BXmyf!ARUAQIl9xYTMOxAEuy39t2eRwYR59kxGZTWZwbq8QxFNb.DJ8ljDk2UTfSWkBjH8FJe5LCBu4JHoWBAe6BE29zxfzPV9DPhn');
        // データをリクエスト ボディに含めて送信する
        xmlHttpRequest.send( data );

    }
</script>
