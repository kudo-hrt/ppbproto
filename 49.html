<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!--### template ###-->
<!-- InquiryForm -->
<template id="caseTemplate">
	<dl>
		<a class="inq-id" href="javascript:void(0)" onclick="inquiryDetailScreenTransition(this.dataset.cId)" data-cId="">
			<dt class="inq-title"></dt>
			<dd>
				<div class="inq-outputNew list-qa-box">
					<p class="list-qa-cont cbd-content"></p>
						<p class="list-qa-ic">NEW</p>
				</div>
				<p class="list-qa-time inq-createdate"></p>
				<p class="list-qa-txt">
					<span>お問い合わせ種類</span>
					<span class="inq-type"></span>
				</p>
				<p class="list-qa-txt">
					<span>ステータス</span>
					<span class="txt-not-fin inq-status"></span>
				</p>
			</dd>
		</a>
	</dl>
</template>

<!-- cbdTemplate -->
<template id="cbdTemplate">
	<div class="contbrd-cont">
		<div class="contbrd-head">
			<dl>
			<dt>
				<span class="actor-text"></span>
				<span class="new-icon">NEW</span>
			</dt>
			<dd class="createddate"></dd>
			</dl>
		</div>
		<div class="contbrd-body">
			<div id="" name="cbdId" class="contbrd-txt">
				<p class="contbrd-content"></p>
			</div>
		</div>
	</div>
</template>

<!-- fileTemplate -->
<template id="fileTemplate">
	<p><a class="fileLink" href="javascript:void(0)"></a></p>
</template>

<!-- uploadFileTemplate -->
<template id="fileUpTemplate">
	<p class="upfile-text"><a target="_blank"></a><span class="inputClear">×</span></p>
</template>

<script type="text/javascript">
<!--
	// 通信先URL　※環境に併せて変更する必要あり！
	// IT環境
	const REQUEST_DOMAIN = "https://paypay-bank--pt52.sandbox.my.salesforce.com";
	const CLIENT_ID = "3MVG9Po2PmyYruunauqSmSe1tO_B3XTZIsmbyWG9BxfOXr_UKDN7GA2xyv1J2b24N7OjXdjgf7wAQ6Fc94AGS";
	const REFLESH_TOKEN = "5Aep861sY.Bl4bMk9ncKxoBVfALQO4xgWbT1fgtPWYc4OPxUGXMzTGo34qQxOYv9jkYyD4lzx7h0uekBz9LDZ89";
	
	/* ST環境
	const REQUEST_DOMAIN = "https://paypay-bank--int1.sandbox.my.salesforce.com";
	const CLIENT_ID = "3MVG9rnryk9FxFMWYw6B7a3vS76.rmtm9OK7HwR46afmPIHnzp5NBdd9c6Q5wHD0gbY_J6PrHxS_uZY94OZR7";
	const REFLESH_TOKEN = "5Aep8616TQxcUXMN._rsxWE0Vp.qZUlq4a2S21KK7q4ghDyI1kYdTAvaq9uv54f67JoCucSXBPLOYjfaY6IVBdD";
	*/
	// 通信処理結果を退避するための変数
	let res;
	// 連携用文字列
	let linkedStr;
	// メールアドレス
	let eMail;
	// ファイルアップロード用ファイル
	let inputFiles = new Array();
	// アップロードファイル操作用：選択Index
	let selectFileIndex;
	// アップロードファイル操作用：アップロード済ファイルサイズ
	let uploadedFileSize = 0;
	// エラーメッセージ（モーダル）
	let errorMessageText;
	// エラー格納用
	let errorInfo = {
		data: "", // データ
		errorThrown: "", // 例外情報
		status: "" // エラー情報
	};
	// 新規投稿用データハッシュ
	const inqRegistData = {
		EncryptedData:null,
		Subject:null,
		Content:null,
		LinkedDial:null
	};
	// 追加投稿用データハッシュ
	const cbdRegistData = {
		EncryptedData:null,
		CaseId:null,	
		Content:null
	};
	// 現在表示している画面ID
	let displayId = null;
	// 画面ID
	const screenNameList = [
		"inquiryForm",
		"noInq",
		"detailsScreen",
		"inqInputScreen",
		"inqConfirmScreen",
		"replyInputScreen",
		"replyConfirmScreen",
		"compScreen",
		"errorScreen"
	];
	// お問い合わせ種別：個人用
	const dialPriv = [
		"dialPrivRegistrationChange",
		"dialPrivToken",
		"dialPrivTransfer",
		"dialPrivAutomaticBankTransfer",
		"dialPrivCertificates",
		"dialPrivOther"
	];
	// お問い合わせ種別：法人用
	const dialCorp = [
		"dialCorpRegistrationChange",
		"dialCorpToken",
		"dialCorpTransfer",
		"dialCorpAutomaticBankTransfer",
		"dialCorpCertificates",
		"dialCorpBA-PLUS",
		"dialCorpOther"
	];
	// お問い合わせ種別：個人用の入力チェック用
	const dialPrivCheckList = [
		"①登録情報の変更",
		"②キャッシュカード・トークン",
		"③振込",
		"④口座自動振替",
		"⑤各種証明書（取引明細・残高証明など）",
		"⑥その他"
	];
	// お問い合わせ種別：法人用の入力チェック用
	const dialCorpCheckList = [
		"①登録情報の変更",
		"②キャッシュカード・トークン",
		"③振込",
		"④口座自動振替",
		"⑤各種証明書（取引明細・残高証明など）",
		"⑥BA-PLUS",
		"⑦その他"
	];
	// 各種手続きダイヤル設定対象
	const procedureDialList = [
		"①登録情報の変更", 
		"②キャッシュカード・トークン", 
		"③振込", 
		"④口座自動振替", 
		"⑤各種証明書（取引明細・残高証明など）"
	];
	// 拡張子のリスト
	const extensionList = ["heic", "xls", "xlsx", "doc", "docx", "png", "jpg", "jpeg", "pdf"];
	
	/**
	 * 初期表示処理
	 */
	$(function(){
		// 連携文字列取得
		//linkedStr = $("input[name='SFConnectParam']").val();
		//linkedStr = '338e2b47705b0d90ac57c8e5cfd39dba90935dc9bdc247b9cf6841ce78cdf4ee'; //PPB 三郎 0010000002
		linkedStr = '1c7ab3d8e3515cfc7a29817281df4b9beaed4276e5163a1996486b6e3c65ede3'; //IT ヘッダ 修正太郎に 0069010381
		//linkedStr = 'd3361861a4295ed0997620097c360026d2f333c83574002420241904864dc8f5'; //IT 時限チェック用
		//linkedStr = '26d2f333c83574002420241904864dc8f5'; //IT システムエラー
		//linkedStr = 'e7e5779eca735ce3d7e1723cc3728becee1ffad539b7fb48c7893cf1de9eb3fb'; //IT 個人テスト 二十太郎
		//linkedStr = '262a838ccef01befe06b6b5033fb3cd843f315dfb1df20e910ef7979bb0d52b7'; //IT
		//linkedStr = 'b2ecf814cc0650ccee0117df3494d1a8d6442398bca5ed2c1cbf6e12278102d2'; //ST
		// モーダル開閉
		$(".ModalBtn").on("click", function(){
			$(".modalOverlay,.modalWrap").fadeIn();
			$("body").css({position:"fixed",top:-1});
			selectId = $(this).attr("id").slice(6);
		});
		// 各種問い合わせ：モーダル閉じる時の動作
		$(".modal__bottomArea").on("click", function(){
			$(".modalOverlay,.modalWrap").fadeOut();
			$("body").css({position:"",top:0});
			SelectRadio(selectId);
		});
		// 問い合わせ種別の変更時処理の追加
		$(".x-data-inqType").change(function(){
			SelectRadio(selectId);
		});
		// お問い合わせ内容：入力クリア
		$(".textinput-box .inputClear").on("click", function(){
			var CurrentScrollY = $(window).scrollTop();
			$(".modalOverlay,.modalWrap_error.confirm-clear").fadeIn();
			$("body").css({position:"fixed",top:-1 * CurrentScrollY});
		});
		// 各種モーダル：戻る時のデフォルト動作
		$(".modal__close").on("click", function(){
			var CurrentScrollY = $(window).scrollTop();
			$(".modalOverlay,.modalWrap_error").fadeOut();
			$("body").css({position:"",top:0 * CurrentScrollY});
		});
		// 削除確認時に削除するボタン押下
		$("#inqDelBtn").on({
			"click":function(){
				// 警告表示のクリア
				inqClearErrorMessage();
				$("#inqTextInput").val("");
				inqReqCheck();
				if($("#inqTextInput").val() == ""){
					$("#inqTextInput").css("background", "#ffffcc");
				}
				$("#inqContentDel").css("opacity", 0);
				$("#inqTextInput").addClass("reqEntry").removeClass("data-on");
			}
		});
		// 削除確認時に削除するボタン押下
		$("#cbdDelBtn").on({
			"click":function(){
				// 警告表示のクリア
				cbdClearErrorMessage();
				$("#cbdTextInput").val("");
				cbdReqCheck();
				if($("#cbdTextInput").val() == ""){
					$("#cbdTextInput").css("background", "#ffffcc");
				}
				$("#cbdContentDel").css("opacity", 0);
				$("#cbdTextInput").addClass("reqEntry").removeClass("data-on");
			}
		});
		// 入力時の下線制御
		//setReqCls("#Modal-inqType, #cbdTextInput");
		// 確認するボタンを非活性にする
		$("#inqConfButton").prop("disabled", true);
		// 問い合わせ種別変更時に確認するボタンを活性化させる
		$("#modalText").change( function(){
			inqReqCheck();
		});
		// 確認するボタンを非活性にする
		$("#cbdConfButton").prop("disabled", true);
		// 新規問い合わせ画面 入力欄の背景色を黄色にする（初期状態の設定）
		if($("#inqTextInput").val() == ""){
			// 黄色
			$("#inqTextInput").css("background", "#ffffcc");
		}
		// お問い合わせ内容入力時処理（背景色の制御）
		$("#inqTextInput").on("keydown keyup focus blur", function() {
			// 値が空の時
			if($(this).val() == ""){
				// 黄色
				$(this).css("background", "#ffffcc");
				$("#inqContentDel").css("opacity", 0);
			// 値が入っている時に白色
			}else{
				// 白色
				$(this).css("background", "");
				$("#inqContentDel").css("opacity", 1);
			}
			inqReqCheck();
		});
		// 個別問い合わせ画面 入力欄の背景色を黄色にする（初期状態の設定）
		if($("#cbdTextInput").val() == ""){
			// 黄色
			$("#cbdTextInput").css("background", "#ffffcc");
		}
		// お問い合わせ内容入力時処理（背景色の制御）
		$("#cbdTextInput").on("keydown keyup focus blur", function() {
			// 値が空の時
			if($(this).val() == ""){
				// 黄色
				$(this).css("background", "#ffffcc");
				$("#cbdContentDel").css("opacity", 0);
			// 値が入っている時に白色
			}else{
				// 白色
				$(this).css("background", "");
				$("#cbdContentDel").css("opacity", 1);
			}
			cbdReqCheck();
		});
		// モーダル閉じるボタン(画面遷移なし)
		$(".mClose").on("click", function(){
			var CurrentScrollY = $(window).scrollTop();
			$(".modalOverlay,.modalWrap_error").fadeOut();
			$(".modalWrap_error").css("display", "none");
			$("body").css({position:"",top:0 * CurrentScrollY});
		});
		// 人格コードの取得
		//const jinkakuCode = $("input[name='JinkakuCode']").val();
		const jinkakuCode = '法人';
		// 人格コードが取得できた場合
		if(jinkakuCode){
			// 人格コードが個人または非居住者の場合
			if(jinkakuCode == "個人" || jinkakuCode == "非居住者"){
				// 個人用を表示
				for(let i = 0; i < dialPriv.length; i++){
					$("#" + dialPriv[i]).show();
				}
				// 法人用を非表示
				for(let i = 0; i < dialCorp.length; i++){
					$("#" + dialCorp[i]).hide();
				}
			}else{
				// 個人用を非表示
				for(let i = 0; i < dialPriv.length; i++){
					$("#" + dialPriv[i]).hide();
				}
				// 法人用を表示
				for(let i = 0; i < dialCorp.length; i++){
					$("#" + dialCorp[i]).show();
				}
			}
		}
		// ファイルアップロード時（新規投稿）
		$("#inqFileName").change(function(){
			// 投稿するボタン、及び戻るボタンを非活性にする
			$("#inqConfButton").prop("disabled", true);
			$("#inqPrevButton").prop("disabled", true);
			// ファイルアップロード共通処理の実行
			uploadCommon("inqFileName", "inqFileList", "inqFileAlert", function(){
				$("#inqPrevButton").prop("disabled", false);
				$("#inqFileName").val("");
				inqReqCheck();
			});
		});
		// ファイルアップロード時（追加投稿）
		$("#cbdFileName").change(function(){
			// 投稿するボタン、及び戻るボタンを非活性にする
			$("#cbdConfButton").prop("disabled", true);
			$("#cbdPrevButton").prop("disabled", true);
			// ファイルアップロード共通処理の実行
			uploadCommon("cbdFileName", "cbdFileList", "cbdFileAlert", function(){
				$("#cbdPrevButton").prop("disabled", false);
				$("#cbdFileName").val("");
				cbdReqCheck();
			});
		});
		// 履歴更新時のイベント処理（ブラウザバックに対応）
		window.onpopstate = function(e){
			// 現在表示している画面に応じた制御を実施
			switch(displayId){
				// ホーム画面（履歴あり）、ホーム画面（履歴なし）、エラー画面
				case "inquiryForm":
				case "errorScreen":
				case "noInq":
					// ログイン画面に戻す
					location.href = "https://" + location.hostname + "/wctx/LoginAction.do?screen=Contactboard"
					break;
				// 個別お問い合わせ 詳細画面
				case "detailsScreen":
					// ホーム画面（履歴あり）へ遷移　※履歴なしの状態でこの画面に遷移することはあり得ない
					changeDisp("inquiryForm");
					break;
				// 新規お問い合わせ（入力画面）
				case "inqInputScreen":
					// 問い合わせ種別の選択状態の取得
					const itype_flg = ( $("#Modal-inqType").html() == "選択してください" ) ? false : true;
					// 問い合わせ内容の入力状態の取得
					const idtail_flg = ($("#inqTextInput").val() == "") ? false : true;
					// いずれかが入力されている場合（ファイルアップロードを含む）
					if(itype_flg || idtail_flg || inputFiles.length > 0){
						// 確認ダイアログを表示
						$(".modalOverlay,.confirm-historyBack").fadeIn();
						$("body").css({position:"fixed",top:-1});
					// 未入力の場合
					}else{
						// ホーム画面に遷移
						sendHome();
					}
					break;
				// 新規お問い合わせ（確認画面）
				case "inqConfirmScreen":
					// 新規お問い合わせ（入力画面）に遷移する
					changeDisp("inqInputScreen");
					break;
				// 個別お問い合わせ返信（入力画面）
				case "replyInputScreen":
					// 問い合わせ内容が入力されている場合（ファイルアップロードを含む）
					if($("#cbdTextInput").val() != "" || inputFiles.length > 0){
						// 確認ダイアログを表示
						$(".modalOverlay,.confirm-historyBack").fadeIn();
						$("body").css({position:"fixed",top:-1});
					// 未入力の場合
					}else{
						// ホーム画面に遷移
						sendHome();
					}
					break;
				// 個別お問い合わせ返信（確認画面）
				case "replyConfirmScreen":
					// 個別お問い合わせ返信（入力画面）に遷移する
					changeDisp("replyInputScreen");
					break;
				// 完了画面
				case "compScreen":
					// ホーム画面（履歴あり）へ遷移　※履歴なしの状態でこの画面に遷移することはあり得ない
					changeDisp("inquiryForm");
					// サーバーから投稿した情報を再取得
					getAllCase();
					break;
				// 上記以外
				default:
					// 通常のブラウザバックの挙動
					history.back();
					break;
			}
		}
		// Ajaxによりケースを取得
		getAllCase();
	});
	
	/**
	 * 初期処理
	 * @args:なし
	 * @return:なし
	 */
	function init(){
		// ファイルアップロード用ファイルをリセット
		inputFiles = new Array();
		// アップロード済ファイルサイズをリセット
		uploadedFileSize = 0;
		// RestApexとの通信時erorrだった場合にエラーのモーダルを表示する処理に変更する
		if(res.result == "SUCCESS"){
			// お問い合わせ0件(null含む)の場合
			if(!res.caseList || res.caseList.length <= 0){
				// 入力画面出力用
				eMail = res.accMail;
				// 新規入力画面に反映
				$("#newInqMail").html(eMail);
				// ホーム画面（履歴なし）を表示
				changeDisp("noInq");
				// 処理中表示を隠す
				hideProgress();
				// 処理を中断
				return;
			}
		// 時限チェックエラー
		}else if(res.result == "TIMED_CHECK"){
			// ホーム画面（履歴なし）を表示
			changeDisp("noInq");
			// 処理中表示を隠す
			hideProgress();
			// モーダルを表示
			return;
		// システムエラー 
		}else{
			// ホーム画面（履歴なし）を表示
			changeDisp("noInq");
			// 処理中表示を隠す
			hideProgress();
			// 処理を中断
			return;
		}
		// お問い合わせ詳細
		$("#inqTextInput").val(null);
		// 背景色を黄色にする
		$("#inqTextInput").css("background", "#ffffcc");
		// お問い合わせ種類の入力欄の取得
		let inqTypeElem = $("#Modal-inqType");
		// お問い合わせ種類が入力されている場合
		if(!inqTypeElem.hasClass("reqEntry")){
			// 未選択状態にする
			inqTypeElem.removeClass("inputSelectItem-on");
			inqTypeElem.removeClass("data-on");
			inqTypeElem.addClass("reqEntry");
			inqTypeElem.html("選択してください");
			$("input[name='inqType']").prop("checked", false);
		}
		// 新規のファイル出力先に子要素があれば削除
        $("#inqFileList").empty();
		// 個別の投稿内容をクリア
		$("#cbdTextInput").val(null);
		// 背景色を黄色にする
		$("#cbdTextInput").css("background", "#ffffcc");
		// 個別のファイル出力先に子要素があれば削除
        $("#cbdFileList").empty();
		// 出力先要素に子要素があれば削除
        $("#listQa").empty();
        // 投稿ボタンを活性化
        $("#inqPost").prop("disabled", false);
        // 確認画面戻るボタンを活性化
        $("#inqPostPrev").prop("disabled", false);
        // 投稿ボタンを活性化
        $("#cbdPost").prop("disabled", false);
        // 確認画面戻るボタンを活性化
        $("#cbdPostPrev").prop("disabled", false);
        // Xボタンを非表示
		$("#inqContentDel").css("opacity", 0);
		// Xボタンを非表示
		$("#cbdContentDel").css("opacity", 0);
		// 入力画面出力用
		eMail = res.accMail;
		// 新規入力画面に反映
		$("#newInqMail").html(eMail);
		// Cookie取得処理を呼び出す
		const cookieList = getCookie();
		// ケースをループ
		for(let c = 0; c < res.caseList.length; c++){
			// NEW表示フラグをfalseで初期化
			let newDisplayFlag = false;
			// コンタクトボード明細を取得
			const cbdFileList = res.caseList[c].cbdFileList;
			// コンタクトボード明細をループ
			for(let i = 0; i < cbdFileList.length; i++){
				// 日付用変数に現在日を取得
				let nowDateTime = new Date();
				// 1ヶ月前にする
				nowDateTime.setMonth(nowDateTime.getMonth() - 1);
				// コンタクトボード明細の時間
				let cbdDateTime;
				// レコード種別が、お客さまの場合
				if(cbdFileList[i].cbd.Classification__c == "問い合わせ"){
					cbdDateTime = new Date(cbdFileList[i].cbd.CreatedDate);
				// PayPay銀行の場合
				}else{
					cbdDateTime = new Date(cbdFileList[i].cbd.LastModifiedDate);
				}
				// 以下のいずれかの条件でnew表示を付与
				// ・コンタクトボード明細の最終更新日が現在日時 - 1ヶ月以後（同値を含む）
				// ・（お客様からの）問い合わせ以外
				// ・（Cookieにて）未参照
				if(
					cbdDateTime >= nowDateTime &&
					cbdFileList[i].cbd.Classification__c != "問い合わせ" &&
					cookieList.indexOf(cbdFileList[i].cbd.Id) < 0
				){
					// NEW表示フラグをfalseに設定
					newDisplayFlag = true;
					// 以後処理不要
					break;
				}
			}
			// NEW表示フラグを反映
			res.caseList[c]["isNew"] = newDisplayFlag;
		}
		// Case template要素を取得
		let caseTemplate = $("#caseTemplate");
		// ケースのリストの件数分
		for(let i = 0; i < res.caseList.length; i++){
			// 要素を取得
			const c = res.caseList[i];
			// case template要素の内容を複製
			let clone = caseTemplate.get(0).content.cloneNode(true);
			// お問い合わせ内容を取得
			let content = c.content;
			// お問い合わせ詳細がnullでない
			if(content != null){
				// 12文字を超える場合
				if(content.length > 30){
					// 省略する
					content = content.substring(0, 30) + "...";
				}
			}
			// 複製したtemplate要素にデータを挿入
			// ケースのIdを設定
			clone.querySelector(".inq-id").dataset.cId = c.record.Id;
			// ケース番号を設定する
			clone.querySelector(".inq-title").textContent = "No.T" + c.record.CaseNumber;
			// お問い合わせ内容を設定する
			clone.querySelector(".cbd-content").textContent = content;
			// ケースの作成日をJST日付かつスラッシュに変換して、設定
			clone.querySelector(".inq-createdate").textContent = changeSlashDate(c.record.CreatedDate);
			// お問い合わせ種類を設定する
			clone.querySelector(".inq-type").textContent = c.record.SubjectIMF__c;
			// ケースのステータスを設定する
			clone.querySelector(".inq-status").textContent = c.record.StatusClient__c;
			// 「回答完了」、「回答に少しお時間をいただいております。」の場合
			if(c.record.StatusClient__c == "回答完了" || c.record.StatusClient__c == "回答に少しお時間をいただいております。"){
				// CSSクラスを削除（グレー）
				clone.querySelector(".inq-status").classList.remove("txt-not-fin");
				// CSSクラスを追加（グリーン）
				clone.querySelector('.inq-status').classList.add("txt-fin");
			}
			// NEW表示しない場合
			if(!c.isNew){
				// newを非表示にする
				clone.querySelector(".list-qa-ic").style.display = "none";
			}
			// caseを画面に出力
			$("#listQa").append(clone);
		}
		// 処理中表示を隠す
		hideProgress();
		// ホーム画面を表示
		changeDisp("inquiryForm");
	}
	
	/**
	 * 画面の表示非表示切り替え
	 * @args:
	 * nextScreen…画面ID
	 * @return:なし
	 */
	function changeDisp(nextScreen){
		// 画面IDリストループ
		for(i = 0; i < screenNameList.length; i++){
			// 指定IDの場合
			if(screenNameList[i] == nextScreen){
				// 表示
				$("#" + screenNameList[i]).show();
			// それ以外
			}else{
				// 非表示
				$("#" + screenNameList[i]).hide();
			}
		}
		// ホーム画面（履歴あり）、もしくはホーム画面（履歴なし）
		if("inquiryForm" == nextScreen || "noInq" == nextScreen){
			$("#title").show();
		} else {
			$("#title").hide();
		}
		// 画面履歴の追加
		history.pushState({displayId:nextScreen}, null, "https://" + location.hostname + "/wctx/TransitAction.do?submitID=010&screen=Contactboard");
		// 遷移先画面IDを退避
		displayId = nextScreen;
	}
	/**
	 * ホーム画面へ遷移
	 */
	function sendHome(){
		// 確認ダイアログのオーバレイをクリア
		$(".modalOverlay,.confirm-historyBack").fadeOut();
		// （入力がある場合）新規お問い合わせ（入力画面）のクリア
		inqClearInput();
		// （入力がある場合）追加お問い合わせ返信（入力画面）のクリア
		cbdClearInput();
		// お問い合わせ0件(null)の場合
		if(!res.caseList || res.caseList.length <= 0){
			// ホーム画面（履歴なし）を表示
			changeDisp("noInq");
			// スクロールをトップにする
			dispScrollTop();
		}else{
			// ホーム画面に遷移
			changeDisp("inquiryForm");
			// スクロールをトップにする
			dispScrollTop();
		}
	}
	/**
	 * 確認ダイアログで閉じるを押した際に履歴を復旧する
	 */
	function pushHistory(){
		history.pushState({displayId:displayId}, null, "https://" + location.hostname + "/wctx/TransitAction.do?submitID=010&screen=Contactboard");
		var CurrentScrollY = $(window).scrollTop();
		$(".modalOverlay,.modalWrap_error").fadeOut();
		$(".modalWrap_error").css("display", "none");
		$("body").css({position:"",top:0 * CurrentScrollY});
	}
	/**
	 * REST認証
	 * @args:
	 * doneMethod…正常終了時に実行される関数
	 * failMethod…異常終了時に実行される関数
	 * @return:なし
	 * @remakrs:doneMethodの引数にはトークンが割り当てられる
	 *          また、ファイルダウンロードで使いまわすため、フィールド変数として保持する
	 */
	var accToken;
	function restAuthorize(doneMethod, faliMethod){
		$.ajax({
			type:"POST",
			crossOrigin:true,
			url: REQUEST_DOMAIN + "/services/oauth2/token",
			dataType:"json",
			cache:false,
			data:{
				"grant_type":"refresh_token",
				"client_id":CLIENT_ID, 
				"refresh_token":REFLESH_TOKEN
			}
		}).done(function(response){
			accToken = "Bearer " + response.access_token;
			doneMethod(accToken);
		}).fail(function (data, errorThrown, status){
			faliMethod();
		});
	}
	
	/**
	 * 初期表示時データ取得
	 * @args:
	 * accToken…アクセストークン
	 * @return:なし
	 */
	function getAllCase(){
		// 処理中表示を出す
		dispProgress();
		restAuthorize(function(accToken){
			$.ajax({
				type:"GET",
				crossOrigin:true,
				url:REQUEST_DOMAIN + "/services/apexrest/IMF_Case",
				dataType:"json",
				cache:false,
				data:{inquiry:linkedStr},
				headers: {"Authorization":accToken},
				timeout: 140000
			}).done(function(response){
				if(response.errorMessage){
					errorMessageText = response.errorMessage.replace(/\n/g, "<br>");
				}
				// 成功
				if(response.result == "SUCCESS"){
					// 処理結果を退避する
					res = response;
					// 画面初期表示処理（SFのケース読み込み）
					init();
				// 時限チェック
				}else if(response.result == "TIMED_CHECK"){
					// エラー画面を表示
					dispErrorScreen();
				// 取引先0件
				}else if(response.result == "NO_ACCOUNT"){
					// 処理結果を退避する
					res = response;
					// ホーム画面（履歴なし）を表示
					changeDisp("noInq");
					// 処理中表示を隠す
					hideProgress();
				// 異常終了
				}else{
					// エラー画面を表示
					dispErrorScreen();
				}
			}).fail(function(data, errorThrown, status){
				// エラー画面を表示
				dispErrorScreen();
			});
		}, dispErrorScreen);
	}
	
	/**
	 * 初期表示時データ取得(再表示用)
	 * @args:なし
	 * @return:なし
	 */
	function getAllCaseWithoutAuth(){
		// 処理中表示を出す
		dispProgress();
		// 通信によるデータ取得
		$.ajax({
			type:"GET",
			crossOrigin:true,
			url:REQUEST_DOMAIN + "/services/apexrest/IMF_Case",
			dataType:"json",
			cache:false,
			data:{inquiry:linkedStr},
			headers: {"Authorization":accToken},
			timeout: 140000
		}).done(function(response){
			if(response.errorMessage){
				errorMessageText = response.errorMessage.replace(/\n/g, "<br>");
			}
			response.result = "error";
			// 成功
			if(response.result == "SUCCESS"){
				// 処理結果を退避する
				res = response;
				// 画面初期表示処理（SFのケース読み込み）
				init();
			// 時限チェック
			}else if(response.result == "TIMED_CHECK"){
				dispTimeoutErrModal();
			// 取引先0件
			}else if(response.result == "NO_ACCOUNT"){
				// 処理結果を退避する
				res = response;
				// ホーム画面（履歴なし）を表示
				changeDisp("noInq");
				// 処理中表示を隠す
				hideProgress();
			// 異常終了
			}else{
				// エラーダイアログを表示
				dispAbnormalErrModal();
			}
		}).fail(function(data, errorThrown, status){
			// エラーダイアログを表示
			dispComErrModal();
		});
	}
	
	/**
	 * コンテンツバージョン（添付ファイル）取得処理
	 * @args:
	 * fileId…添付ファイルのID
	 * resolve…処理完了時に実行される関数
	 * @return:なし
	 * @remakrs:全てのファイルの紐付けが完了するとresolveが実行される
	 * 添付ファイルの取得は非同期で行われるため、resolveを使うことで処理の同期化を図れる
	 */
	function getContentVersion(fileId, fileName){
		$.ajax({
			type:"GET",
			crossOrigin:true,
			url:REQUEST_DOMAIN + "/services/data/v54.0/sobjects/ContentVersion/" + fileId + "/VersionData",
			cache:false,
			headers:{"Authorization":accToken},
			xhrFields:{responseType:"blob"},
			timeout: 140000
		}).done(function(fileContent){
			// URL変換する
			const alink = document.createElement("a");
			alink.download = fileName;
			const fileUrl = URL.createObjectURL(new Blob(
				[fileContent],
				{type: "application/octet-stream"}
			));
			alink.href = fileUrl;
			alink.click();
		}).fail(function (data, errorThrown, status) {
			dispComErrModal();
		});
	}
	
	/**
	 * エラー画面表示
	 * @args:
	 * accToken…アクセストークン
	 * @return:なし
	 */
	function dispErrorScreen(){
		// 現在日時の取得
		let today = new Date();

		// 年月日時分を取得
		let formatedDate = changeSlashDate(today);
		// 秒を取得
		let second = ("0" + today.getSeconds()).slice(-2);
		// エラー発生日時を設定
		$("#errorDateTime").html("発生日時：" + formatedDate + ":" + second);
		// エラー画面を表示
		changeDisp("errorScreen");
		// ログアウトボタンを非表示
		$(".logoutWrap").css("display","none");
		// 処理中表示を隠す
		hideProgress();
	}
	
    /**
	 * 新規投稿
	 * @args:なし
	 * @return:なし
	 */
	function registInquery(){
		// 人格コードの取得
		//const jinkakuCode = $("input[name='JinkakuCode']").val();
		const jinkakuCode = '法人';
		// お問い合わせ種類チェックフラグ
		let inqTypeCheckFlg = false;
		// コンタクトボード種類チェック
		if(jinkakuCode == "個人" || jinkakuCode == "非居住者"){
			// 選択肢以外の値の場合
			if(!dialPrivCheckList.includes(inqRegistData.Subject)){
				inqTypeCheckFlg = true;
			}
		} else if(!dialCorpCheckList.includes(inqRegistData.Subject)){
			inqTypeCheckFlg = true;
		}
		if(inqTypeCheckFlg){
			// エラーメッセージの表示
			$("#inqTypeOutputError").show();
			// スクロールをトップにする
			dispScrollTop();
			// 処理終了
			return null;
		}
		
		$("#inqPost").prop("disabled", true);
		$("#inqPostPrev").prop("disabled", true);
		$.ajax({
			type:"POST",
			crossOrigin:true,
			url:REQUEST_DOMAIN + "/services/apexrest/IMF_Case",
			cache:false,
			headers:{"Authorization":accToken, "Content-Type":"application/json"},
			dataType:"json",
			data:JSON.stringify(inqRegistData),
			timeout: 10000
		}).done(function(response){
			// 登録したコンタクトボード明細のIDを取得
			const cbdId = response.cbdId;
			// エラーメッセージの退避
			if(response.errorMessage){
				errorMessageText = response.errorMessage.replace(/\n/g, "<br>");
			}
			// 正常終了時
			if(response.result == "SUCCESS"){
				// 添付ファイルがある場合
				if(inputFiles.length > 0){
					// 添付ファイルの登録
					uploadFileRegist(cbdId, accToken, inputFiles);
				// 添付ファイルが無い場合
				}else{
					// 完了画面を表示する
					changeDisp("compScreen");
					// スクロールをトップにする
					dispScrollTop();
				}
			// メールアドレス不正
			}else if(response.result == "INVALID_EMAIL_ADDRESS"){
				dispInvmailErrModal();
			// 時限チェック
			}else if(response.result == "TIMED_CHECK"){
				dispTimeoutErrModal();
			// 異常終了
			}else{
				dispAbnormalErrModal();
			}
		}).fail(function (data, errorThrown, status) {
			dispRegisComErrModal();
		});
	}
	
	/**
	 * 個別投稿
	 * @args:なし
	 * @return:なし
	 */
	function registContactBoard(){
		$("#cbdPost").prop("disabled", true);
		$("#cbdPostPrev").prop("disabled", true);
		$.ajax({
			type:"POST",
			crossOrigin:true,
			url:REQUEST_DOMAIN + "/services/apexrest/IMF_ContactBoardDetail",
			cache:false,
			headers: {"Authorization":accToken, "Content-Type":"application/json"},
			dataType:"json",
			data:JSON.stringify(cbdRegistData),
			timeout: 10000
		}).done(function(response){
			// 登録したコンタクトボード明細のIDを取得
			const cbdId = response.cbdId;
			// エラーメッセージを退避
			if(response.errorMessage){
				errorMessageText = response.errorMessage.replace(/\n/g, "<br>");
			}
			// 正常終了時
			if(response.result == "SUCCESS"){
				// 添付ファイルがある場合
				if(inputFiles.length){
					// 添付ファイルを登録
					uploadFileRegist(cbdId, accToken, inputFiles);
				// 添付ファイルが無い場合
				}else{
					// 完了画面を表示する
					changeDisp("compScreen");
					// スクロールをトップにする
					dispScrollTop();
				}
			// 時限チェック
			}else if(response.result == "TIMED_CHECK"){
				dispTimeoutErrModal();
			// 異常終了
			}else{
				dispAbnormalErrModal();
			}

		}).fail(function (data, errorThrown, status) {
			dispRegisComErrModal();
		});
	}
	
	/**
	 * 添付ファイル登録
	 * @args:
	 * cbdId…コンタクトボード明細のID
	 * accToken…アクセストークン
	 * inputFiles…登録する添付ファイル
	 * @return:なし
	 */
	function uploadFileRegist(cbdId, accToken, inputFiles){
		// 添付ファイルループ
		for(let i = 0; i < inputFiles.length; i++){
			// 登録用のJSON生成
			const cvJson = {
				Title:inputFiles[i].name,
				PathOnClient:inputFiles[i].name,
				VersionData:inputFiles[i].versionData
			}
			// ContentVersionへの登録
			$.ajax({
				type:"POST",
				url:REQUEST_DOMAIN + "/services/data/v54.0/sobjects/ContentVersion",
				cache:false,
				headers:{"Authorization":accToken, "Content-Type":"application/json"},
				dataType:"json",
				data:JSON.stringify(cvJson),
				timeout: 15000
			}).done(function(cv){
				// 処理結果からContentVersionレコードのIDを取得
				const cvId = cv.id;
				// ContentDocumentId取得用のクエリ生成
				const query = "SELECT+ContentDocumentId+FROM+ContentVersion+WHERE+Id+=+'" + cvId + "'";
				// クエリによる問い合わせ
				$.ajax({
					type:"GET",
					crossOrigin:true,
					url:REQUEST_DOMAIN + "/services/data/v54.0/query/?q=" + query,
					cache:false,
					headers: {"Authorization":accToken},
					timeout: 10000
				}).done(function(res){
					// 処理結果レコードの取得
					const records = res.records;
					// ContentDocumentIdを取得
					const cdId = records[0].ContentDocumentId;
					// ContentDocumentLink登録用のJSON生成
					const linkJson = {
						ContentDocumentId:cdId,
						LinkedEntityId:cbdId,
						Visibility:"AllUsers"
					};
					// ContentDocumentLink登録
					$.ajax({
						type:"POST",
						crossOrigin:true,
						url:REQUEST_DOMAIN + "/services/data/v54.0/sobjects/ContentDocumentLink",
						cache:false,
						headers:{"Authorization":accToken, "Content-Type":"application/json"},
						dataType:"json",
						data:JSON.stringify(linkJson),
						timeout: 10000
					// 正常終了時
					}).done(function(res){
						// ホーム画面を表示する
						changeDisp("compScreen");
						// スクロールをトップにする
						dispScrollTop();
					// 異常終了時
					}).fail(function(data, errorThrown, status) {
						dispRegisComErrModal();
					});
				}).fail(function(data, errorThrown, status) {
					dispRegisComErrModal();
				});
			}).fail(function(data, errorThrown, status) {
				dispRegisComErrModal();
			});
		}
	}
	
	/**
	 * 初期表示処理（コンタクトボード明細）
	 * @args:
	 * selectedCaseId:選択されたケースID
	 * @return:なし
	 */
	function sendDetailsScreen(selectedCaseId){
		// 画面内容をクリアする
		$("#outputCbdTemp").html(null);
		// 投稿するボタンにケースIdを設定
		$("#replyButton").get(0).dataset.cId = selectedCaseId;
		// Cookie取得処理を呼び出す
		const cookieList = getCookie();
		// NEW付与対象のIDを格納する配列
		let newTargetList = [];
		// 添付ファイルのリスト
		let cbdFileList;
		// ケースの件数分
		for(i = 0; i < res.caseList.length; i++){
			// 要素取得
			const rec = res.caseList[i].record;
			// URLのケースIdと選択Idが一致する場合
			if(selectedCaseId == rec.Id){
				// ページタイトルを設定
				$("#contbrdTitle").text("お問い合わせ番号：No.T" + rec.CaseNumber);
				// 添付ファイルを取得
				cbdFileList = res.caseList[i].cbdFileList;
				// コンタクトボード明細レコードとファイルの組み合わせリストの件数分
				for(j = 0; j < cbdFileList.length; j++){
				
					let idFlg = {};
					// NEW表示フラグをfalseで初期化
					let newDisplayFlag = false;
					// 日付用変数に現在日を取得
					let nowDateTime = new Date();
					//  1ヶ月前にする
					nowDateTime.setMonth(nowDateTime.getMonth() - 1);
					// コンタクトボード明細の時間
					let cbdDateTime;
					// レコード種別がお客さまの場合
					if(cbdFileList[j].cbd.Classification__c == "問い合わせ"){
						// 作成日を用いる
						cbdDateTime = new Date(cbdFileList[j].cbd.CreatedDate);
					// PayPay銀行の場合
					}else{
						// 更新日を用いる
						cbdDateTime = new Date(cbdFileList[j].cbd.LastModifiedDate);
					}
					// 以下のいずれかの条件でnew表示を付与
					// ・コンタクトボード明細の最終更新日が現在日時 - 1ヶ月以後（同値を含む）
					// ・（お客様からの）問い合わせ以外
					// ・（Cookieにて）未参照
					if(
						cbdDateTime >= nowDateTime &&
						cbdFileList[j].cbd.Classification__c != "問い合わせ" &&
						cookieList.indexOf(cbdFileList[j].cbd.Id) < 0
					){
						newTargetList.push(cbdFileList[j].cbd.Id);
						cookieList.push(cbdFileList[j].cbd.Id);
						newDisplayFlag = true;
					}
					// New表示可否の退避
					cbdFileList[j].isNew = newDisplayFlag;
				}
			}
		}
		// コンタクトボード明細templateを取得
		let cbdTemplate = $("#cbdTemplate");
		// コンタクトボード明細のリストの件数分
		for(let i = 0; i < cbdFileList.length; i++){
			// 要素を取得
			const cbd = cbdFileList[i].cbd;
			// 紐付く添付ファイルを取得
			const cvList = cbdFileList[i].contentVersions;
			// コンタクトボード明細templateの内容を複製
			let clone = cbdTemplate.get(0).content.cloneNode(true);
			// 複製したtemplate要素にデータを挿入
			// レコード種別が、お客さまの場合
			if(cbd.Classification__c == "問い合わせ"){
				// お客さまクラスを付与
				clone.querySelector(".contbrd-head").classList.add("customer");
				// アクター名を「お客さま」に設定
				clone.querySelector(".actor-text").textContent = "お客さま";
				// コンタクトボード明細の投稿内容を改行をタグ変換して設定
				clone.querySelector(".contbrd-content").innerHTML = cbd.Content__c.replaceAll("<", "&lt;").replaceAll(">", "&gt;").replace(/\n/g, "<br>");
				// コンタクトボード明細の作成日を日付をJSTに変換する処理を呼び出して、設定する
				clone.querySelector(".createddate").textContent = changeSlashDate(cbd.CreatedDate);
			// PayPay銀行の場合
			}else{
				// 回答クラスを付与
				clone.querySelector(".contbrd-head").classList.add("answer");
				// アクター名を「PayPay銀行」に設定
				clone.querySelector(".actor-text").textContent = "PayPay銀行";
				// CSRF対策のため、タグ変換
				let content = cbd.Content__c.replaceAll("<", "&lt;").replaceAll(">", "&gt;");
				// コンタクトボード明細の投稿内容を引数にURLリンク化処理を呼び出し
				content = AutoLink(content);
				// 値が入力されている場合
				if(content){
					// リンク化した投稿内容を設定
					// textContentに入れるとHTMLエンティティに変換されるため、innerHTMLに入れる
					clone.querySelector(".contbrd-content").innerHTML = content.replace(/\n/g, "<br>");
				}
				// コンタクトボード明細の最終更新日を日付をJSTに変換する処理を呼び出して、設定する
				clone.querySelector(".createddate").textContent = changeSlashDate(cbd.LastModifiedDate);
			}
			clone.querySelector(".contbrd-txt").id = "file" + cbd.Id;
			// 繰り返し初回の場合
			if(i == 0){
				// 初回の全表示用クラスを付与
				clone.querySelector(".contbrd-body").classList.add("first");
			}else{
				// クリック時の開閉を入れる
				$(clone.querySelector(".contbrd-cont")).click(function(){
					// アンカー＝ダウンロードリンクを押された場合、挙動しないよう制御
					if(event.target.tagName != "A"){
						$(this).toggleClass("open");
					}
				});
			}
			// NEW表示しない場合
			if(!cbdFileList[i].isNew){
				// New表示を隠す
				clone.querySelector(".new-icon").style.display = "none";
			}
			// コンタクトボード明細を画面に出力
			$("#outputCbdTemp").append(clone);
			// ファイルがある場合
			if(cbdFileList[i].contentVersions.length > 0){
				// file template要素を取得
				let fileTemplate = $("#fileTemplate");
				// 「ファイル」固定文言タグを生成
				let fileFixedText = $("<p>");
				fileFixedText.html("ファイル");
				fileFixedText.css({"font-weight":"bold", "margin-top":"10px"});
				// 画面に追加
				$("#file" + cbd.Id).append(fileFixedText);
				// 添付ファイルリストを取得
				const cvList = cbdFileList[i].contentVersions;
				// ファイルの件数分
				for(j = 0; j < cvList.length; j++){
					// file template要素の内容を複製
					let fileClone = fileTemplate.get(0).content.cloneNode(true);
					// ダウンロード用にIDを退避
					fileClone.querySelector('.fileLink').id = cvList[j].Id;
					// 表示内容にファイル名を設定
					fileClone.querySelector('.fileLink').textContent = cvList[j].Name;
					// クリック時の動作定義
					fileClone.querySelector('.fileLink').onclick = function(){
						getContentVersion(this.id, this.textContent);
					}
					// ファイルを画面に出力
					$("#file" + cbd.Id).append(fileClone);
				}
			}
		}
		// NEW表示対象がある場合
		if(newTargetList.length > 0){
			// 表示したため、Cookieの情報を書き換える
			setCookie(newTargetList);
		}
		// 戻るボタンを活性化する
		$("#detailPrevButton").prop("disabled", false);
	}
	/**
	 * コンタクトボード明細から戻る処理
	 */
	function prevDetail(){
		// 戻るボタンを非活性にする
		$("#detailPrevButton").prop("disabled", true);
		// 初期表示処理
		init();
	}
	/**
	 * URLの記載があった場合、リンク化する
	 * @args:
	 * str:対象の文字列
	 * @return:URLをリンク用のタグに変換した文字列
	 */
	function AutoLink(str) {
		// 値が無ければ何もしない
		if(!str){return;}
		// 正規表現
		let regexp_url = /((h?)(ttps?:\/\/[a-zA-Z0-9.\-_@:/~?%&;=+#',()*!]+))/g; // ']))/;
		let regexp_makeLink = function(all, url, h, href) {
		return "<a href='h" + href + "' target='_blank'>" + url + "</a>";
		}
		// URLをタグ変換して返却
		return str.replace(regexp_url, regexp_makeLink);
	}
	
	/**
	 * Cookie取得
	 * @args:なし
	 * @return:Cookieに格納されている参照済のコンタクトボード明細の配列
	 **/
	function getCookie(){
		// 結果返却用配列
		let resultCbdIdList = [];
		// Cookieを取得
		let nowCookie = document.cookie;
		// Cookieがnullもしくはundefinedでない場合
		if(nowCookie){
			// 値を ";" で分割して1）の配列に格納
			const tempIdList = nowCookie.split(";");
			// 上記配列をループ
			for(let i = 0; i < tempIdList.length; i++){
				// 値を "=" で分割
				const data = tempIdList[i].split("=");
				// キーが本処理で扱うCookieの場合
				if((data[0].trim() == "IMFCookie") && data[1]){
					// 結果返却用配列に追加
					return JSON.parse(data[1]);
				}
			}
		}
		// 結果を返却
		return resultCbdIdList;
	}
	
	/**
	 * Cookieに値設定
	 * @args:
	 * cbdIdList…Cookieに格納するコンタクトボード明細のIDリスト
	 * @return:なし
	 */
	function setCookie(cbdIdList){
		// Cookieを分割して格納する配列
		let tempIdList = [];
		// 結果返却用配列
		let resultCbdIdList = [];
		// Cookieを取得
		let nowCookie = document.cookie;
		// Cookieがnullもしくはundefinedでない場合
		if(nowCookie){
			// 値を ";" で分割して1）の配列に格納
			tempIdList = nowCookie.split(";");
			// 値の件数分
			tempIdList.forEach(data => {
				// 値を "=" で分割
				data = data.split("=");
				// キーが本処理で扱うCookieの場合
				if(data[0].trim() == "IMFCookie" && data[1]){
					// 結果返却用配列に追加
					resultCbdIdList = JSON.parse(data[1]);
				}
			})
		}
		// 引数で渡されたIDの内容をCookieに退避されている配列に追加する
		for(let i = 0; i < cbdIdList.length; i++){
			if(resultCbdIdList.indexOf(cbdIdList[i]) < 0){
				resultCbdIdList.push(cbdIdList[i]);
			}
		}
		// Cookieに書き込む（保持期限は30日）
		const d = new Date();
		d.setMonth(d.getMonth() + 1);
		document.cookie = "IMFCookie=" + JSON.stringify(resultCbdIdList) + "; expires=" + d.toUTCString();
	}
	
	/**
	 * 個別問い合わせ 詳細画面へ遷移
	 * @args:ケースID
	 * @return:なし
	 */
	 function inquiryDetailScreenTransition(caseId){
	 	// 個別問い合わせ画面に内容を反映
		sendDetailsScreen(caseId);
		// 画面遷移する
		changeDisp("detailsScreen");
		// スクロールをトップにする
		dispScrollTop();
	}
	/** 
	 * 日付をJSTに変換
	 * @args:変換前(UTC形式)の日付文字列
	 * @return:変換後(JST形式)の日付文字列
	 */
	function changeSlashDate(dateTime){
		// 日付オブジェクトに引数の日付を設定して準備
		const newDate = new Date(dateTime);
		// 年を取得
		const year = newDate.getFullYear();
		// 月を取得し1を加算
		const month = ("0" + (newDate.getMonth() + 1)).slice(-2);
		// 日を取得
		const day = ("0" + (newDate.getDate())).slice(-2);
		// 先頭文字列"0"に、1）から時間(h)を取得して結合した値を最後から2文字までを変数に格納
		const hour = ("0" + (newDate.getHours())).slice(-2);
		// 先頭文字列"0"に、1）から分(m)を取得して結合した値を最後から2文字までを変数に格納
		const minute = ("0" + (newDate.getMinutes())).slice(-2);
		// 値を返却
		return year + "/" + month + "/" + day + " " + hour + ":" + minute;
	}
	
	/**
	 * 入力画面で入力された情報を確認画面の要素に反映
	 * @args:なし
	 * @return:なし
	 */
	function outputValueInqConf(){
		// お問い合わせ種類のエラーメッセージ削除
		$("#inqTypeOutputError").hide();
		// 投稿するボタン、及び戻るボタンを非活性にする
		$("#inqConfButton").prop("disabled", true);
		$("#inqPrevButton").prop("disabled", true);
		// 2000文字以下チェック
		if(checkLength($("#inqTextInput").val(), 2000)){
			// エラーメッセージの表示
			$("#inqOutputError").html("文字数が制限を超えています。<BR>全角2000文字以内で、もう一度入力してください。");
			// 投稿するボタン、及び戻るボタンを活性にする
			$("#inqConfButton").prop("disabled", false);
			$("#inqPrevButton").prop("disabled", false);
			// 処理を中断する
			return null;
		}
		// 登録用データに値を退避
		inqRegistData.EncryptedData = linkedStr;
		inqRegistData.Subject = $("#Modal-inqType").text();
		inqRegistData.Content = $("#inqTextInput").val();
        // 画面表示用に値を反映
		$("#inqConfMailText").html(eMail);
		$("#inqConfTypeText").html(inqRegistData.Subject);
		$("#inqConfDtailsText").html(inqRegistData.Content.replaceAll("<", "&lt;").replaceAll(">", "&gt;").replace(/\n/g, "<br>"));
		// 選択値を取得
		//const jinkakuCode = $("input[name='JinkakuCode']").val();
		const jinkakuCode = '法人';
		let selectedItem = $("#Modal-inqType").text();
		// 人格コードが個人、もしくは非居住者の場合
		if(jinkakuCode == "個人" || jinkakuCode == "非居住者"){
			// 各種手続きダイヤル設定対象の場合
			if(procedureDialList.includes(selectedItem)){
				inqRegistData.LinkedDial = "各種手続きダイヤル";
			}else{
				inqRegistData.LinkedDial = "その他ダイヤル";
			}
		// 人格コードが法人の場合
		}else{
			inqRegistData.LinkedDial = "法人ダイヤル";
		}
		// アップロード表示のクリア
		$("#inqUploadFiles").html(null);
		// アップロードファイルがある場合
		if(inputFiles.length > 0){
			// アップロードされたファイル名を追加
			for(let i = 0; i < inputFiles.length; i++){
				$("#inqUploadFiles").append($("<p>").text(inputFiles[i].name));
			}
		// アップロードファイルが無い場合
		}else{
			// なしを表示
			$("#inqUploadFiles").append($("<p>").text("なし"));
		}
		// 確認画面へ遷移する
        changeDisp("inqConfirmScreen");
        // 投稿するボタン、及び戻るボタンを活性に戻す
		$("#inqConfButton").prop("disabled", false);
		$("#inqPrevButton").prop("disabled", false);
        // スクロールをトップにする
		dispScrollTop();
	}
	
	/**
	 * 入力画面で入力された情報を確認画面の要素に反映
	 * @args:なし
	 * @return:なし
	 */
	function outputValueCbdConf(){
		// 投稿するボタン、及び戻るボタンを非活性にする
		$("#cbdConfButton").prop("disabled", true);
		$("#cbdPrevButton").prop("disabled", true);
		// 2000文字チェック
		if(checkLength($("#cbdTextInput").val(), 2000)){
			// エラーメッセージの表示
			$("#cbdOutputError").html("文字数が制限を超えています。<BR>全角2000文字以内で、もう一度入力してください。");
			// 投稿するボタン、及び戻るボタンを活性にする
			$("#cbdConfButton").prop("disabled", false);
			$("#cbdPrevButton").prop("disabled", false);
			// 処理を中断する
			return null;
		}
		// 登録用にデータを退避
		cbdRegistData.EncryptedData = linkedStr;
		cbdRegistData.CaseId = $("#replyButton").get(0).dataset.cId;
		cbdRegistData.Content = $("#cbdTextInput").val();
		// 画面表示用に値を反映
		$("#cbdConfDtailsText").html(cbdRegistData.Content.replaceAll("<", "&lt;").replaceAll(">", "&gt;").replace(/\n/g, "<br>"));
		// アップロード表示のクリア
        $("#cbdUploadFiles").html(null);
		// アップロードファイルがある場合
		if(inputFiles.length > 0){
			// アップロードされたファイル名を追加
			for(let i = 0; i < inputFiles.length; i++){
				$("#cbdUploadFiles").append($("<p>").text(inputFiles[i].name));
			}
		// アップロードファイルが無い場合
		}else{
			// なしを表示
			$("#cbdUploadFiles").append($("<p>").text("なし"));
		}
		// 確認画面へ遷移する
		changeDisp("replyConfirmScreen");
		// 投稿するボタン、及び戻るボタンを活性に戻す
		$("#cbdConfButton").prop("disabled", false);
		$("#cbdPrevButton").prop("disabled", false);
		// スクロールをトップにする
		dispScrollTop();
	}
	
	/**
	 * 文字数チェック
	 * @args:
	 * content:入力された内容(文字列)
	 * limitLength:最大文字数(数値)
	 * @return:チェック結果(True:文字数超過/False:文字数制限内)
	 */
	function checkLength(content, limitLength){
		// 値がない場合、エラー
		if(!content){return true}
		// 文字数チェックの結果を返却
		return (content.length <= limitLength) ? false : true;
	}
	
	/**
	 * 入力されたらボタンを活性化する（新規投稿）
	 * @args:なし
	 * @return:なし
	 */
	function inqReqCheck(){
		// 問い合わせ種別の選択状態の取得
		const itype_flg = ( $("#Modal-inqType").html() == "選択してください" ) ? false : true;
		// 問い合わせ内容の入力状態の取得
		const idtail_flg = checkInput($("#inqTextInput").val());
		// 入力状態によってボタンの活性／非活性の切り替え
		$("#inqConfButton").prop("disabled", !(itype_flg && idtail_flg));
	}
	
	/**
	 * 入力されたらボタンを活性化する（個別投稿）
	 * @args:なし
	 * @return:なし
	 */	
	function cbdReqCheck(){
		// 問い合わせ内容の入力状態の取得
		const cdtail_flg = checkInput($("#cbdTextInput").val());
		// 入力状態によってボタンの活性／非活性の切り替え
		$("#cbdConfButton").prop("disabled", !cdtail_flg);
	}
	
	/**
	 * 入力チェック ※SalesforceはU0020以下の文字が切り捨てられるため、そのチェック
	 * @args:val…チェック対象の値
	 * @return:true/チェックOK false/チェックNG
	 */
	function checkInput(val){
		// 値未入力ならNG
		if(val.trim() == "")return false;
		// 登録可能な文字があるか
		let hasValue = false;
		// 文字数分ループ
		for(let i = 0; i < val.length; i++){
			// 該当の文字のUnicode値(10進数)を取得。32(16進数の20)より値の高い文字がある　かつ　全角スペース（12288）以外の文字がある場合
			if(val.codePointAt(i) > 32 && val.codePointAt(i) != 12288){
				// 登録可能な文字あり
				hasValue = true;
				// 以後処理しない
				break;
			}
		}
		// 登録可能な文字があるかを返却
		return hasValue;
	}
	/**
	 * エラーメッセージを削除する（新規投稿）
	 * @args:なし
	 * @return:なし
	 */	
	function inqClearErrorMessage(){
		// お問い合わせ詳細のエラーメッセージ削除
		$("#inqOutputError").html(null);
		// お問い合わせ種類のエラーメッセージ削除
		$("#inqTypeOutputError").hide();
		// ファイルのエラーメッセージ削除
		$("#inqFileAlert").html(null);
	}
	/**
	 * エラーメッセージを削除する（個別投稿）
	 * @args:なし
	 * @return:なし
	 */	
	function cbdClearErrorMessage(){
		// 投稿内容のエラーメッセージ削除
		$("#cbdOutputError").html(null);
		// ファイルのエラーメッセージ削除
		$("#cbdFileAlert").html(null);
	}
	/**
	 * 戻るボタン処理（新規投稿）
	 * @args:なし
	 * @return:なし
	 */
	function inqPrevAction(){
		// 問い合わせ種類選択の値設定状況確認
		itype_flg = (typeof $("input[name='inqType']:checked").val() == "undefined") ? false : true;
		// 問い合わせ内容の入力状況確認
		idtail_flg  = ($("#inqTextInput").val() == "" ) ? false : true;
		// いずれか入力されている場合
		if(itype_flg || idtail_flg || inputFiles.length > 0){
			// 確認ダイアログを表示
			$(".modalOverlay,.confirm-back").fadeIn();
			$("body").css({position:"fixed",top:-1});
		// いずれも未入力の場合
		}else{
			// 入力内容のクリア
			inqClearInput();
			// ホーム画面に遷移
			sendHome();
		}
	}
	
	/**
	 * 戻るボタン時の入力内容クリア処理（新規投稿）
	 * @args:なし
	 * @return:なし
	 */
	function inqClearInput(){
		// 問い合わせ種類選択をクリア
		$("input[name='inqType']:checked").prop("checked", false);
		$("#Modal-inqType").html("選択してください");
		// 表示色の調整
		if(!$("#Modal-inqType").hasClass("reqEntry")){
			$("#Modal-inqType").addClass("reqEntry").removeClass("inputSelectItem-on data-on");
		}
		// 問い合わせ内容をクリア
		$("#inqTextInput").val(null);
		// 背景色を黄色
		$("#inqTextInput").css("background", "#ffffcc");
		// 確認するボタンを非活性にする
		$("#inqConfButton").prop("disabled", true);
		// Xボタンを非表示
		$("#inqContentDel").css("opacity", 0);
		// ファイルアップロード用ファイルをリセット
		inputFiles = new Array();
		// アップロード済ファイルサイズをリセット
		uploadedFileSize = 0;
		// 警告表示のクリア
		inqClearErrorMessage();
		// アップロードファイル表示のクリア
		$("#inqFileList").html(null);
		// オーバレイをクリア（残すと前画面でオーバレイが残るため）
		$(".modalOverlay,.confirm-back").fadeOut();
	}
	
	/**
	 * 戻るボタン処理（個別投稿）
	 * @args:なし
	 * @return:なし
	 */
	function cbdPrevAction(){
		// 問い合わせ内容が未入力
		if($("#cbdTextInput").val() == "" && inputFiles.length <= 0){
			 cbdClearInput();
			// 詳細画面に遷移
			changeDisp("detailsScreen");
			// スクロールをトップにする
			dispScrollTop();
		// 入力されている
		}else{
			// 確認ダイアログを表示
			$(".modalOverlay,.confirm-back").fadeIn();
			$("body").css({position:"fixed",top:-1});
		}
	}
	
	/**
	 * 戻るボタン時の入力内容クリア処理（個別投稿）
	 * @args:なし
	 * @return:なし
	 */
	function cbdClearInput(){
		// 入力内容のクリア
		$("#cbdTextInput").val(null);
		// 黄色
		$("#cbdTextInput").css("background", "#ffffcc");
		// 確認するボタンを非活性にする
		$("#cbdConfButton").prop("disabled", true);
		// Xボタンを非表示
		$("#cbdContentDel").css("opacity", 0);
		// ファイルアップロード用ファイルをリセット
		inputFiles = new Array();
		// アップロード済ファイルサイズをリセット
		uploadedFileSize = 0;
		// 警告表示のクリア
		cbdClearErrorMessage();
		// アップロードファイル表示のクリア
		$("#cbdFileList").html(null);
		// オーバレイをクリア（残すと前画面でオーバレイが残るため）
		$(".modalOverlay,.confirm-back").fadeOut();
		// 詳細画面に遷移
		changeDisp("detailsScreen");
		// スクロールをトップにする
		dispScrollTop();
	}
	
	/**
	 * ファイル削除（新規投稿）
	 * @args:なし
	 * @return:なし
	 */
	function inqDeleteFile(){
		// 警告表示のクリア
		inqClearErrorMessage();
		// 選択された画面要素の削除
		$("#inqFileList").children()[selectFileIndex].remove();
		// 合計ファイルサイズから減算
		uploadedFileSize = uploadedFileSize - inputFiles[selectFileIndex].size;
		// 裏で持っているデータの削除
		inputFiles.splice(selectFileIndex, 1);
	}
	
	/**
	 * ファイル削除（個別投稿）
	 * @args:なし
	 * @return:なし
	 */
	function cbdDeleteFile(){
		// 警告表示のクリア
		cbdClearErrorMessage();
		// 選択された画面要素の削除
		$("#cbdFileList").children()[selectFileIndex].remove();
		// 合計ファイルサイズから減算
		uploadedFileSize = uploadedFileSize - inputFiles[selectFileIndex].size;
		// 裏で持っているデータの削除
		inputFiles.splice(selectFileIndex, 1);
	}
	
	/**
	 * ファイルアップロード処理（再帰）
	 * @args:
	 * elemFile…ファイルアップロード用のElement(input type="file"の要素)
	 * files…アップロード対象のファイルリスト(input type="files"要素の.files)
	 * index…処理番号
	 * finishMethod…完了時に実行される処理
	 * @return:なし
	 * @remakrs:本処理は非同期処理を順序立てて呼び出す必要があるため、本処理内部で自身を再帰的にコールしている
	 * 実装者はindexに最初の番号=0を付与してあげれば後のファイル読み込みを再帰的に行ってくれるため、ループ呼び出し
	 * 等をしないこと
	 */
	function recursiveFileRead(elemFile, files, index, finishMethod){
		// FileReader生成
		const reader = new FileReader();
		// アップロード用のファイル情報
		const inputFileData = {
			name:files[index].name,
			versionData:null,
			size:files[index].size
		};
		// ファイル読込時
		reader.onload = function(){
			// 読込結果の取得
			const baseFile = this.result;
			// （フォーマット定義部分を除去するため）カンマ分割
			const spFile = baseFile.split(",");
			// カンマ以後の内容を取得し、アップロード用のファイル情報に書き込む
			inputFileData.versionData = spFile[1];
			// アップロード用の配列に退避
			inputFiles.push(inputFileData);
			// 処理対象がある場合
			if(files.length - 1 > index){
				// 再帰実行
				recursiveFileRead(elemFile, files, index + 1, finishMethod);
			// 処理対象が無い場合
			}else{
				// 入力されたファイル情報をリセット
				elemFile.value = null;
				// 完了時の処理を呼び出す
				finishMethod();
			}
		}
		// ファイル読込の開始
		reader.readAsDataURL(files[index]);
	}
	
	/**
	 * お問い合わせ種別選択時処理
	 * @args:
	 * id:対象の項目ID
	 * @return:なし
	 * @remakrs:idはModal-xxxの形式になっている前提
	 */
	function SelectRadio(id){
		// 選択要素名を取得
		const childName = $("#" + id).children("li").attr("name");
		// 選択されている要素を取得
		const selectValue = $("input[name='" + childName + "']:checked").next().html();
		// 選択値の反映
		$("#Modal-"+ id).html(selectValue);
		// 選択されている値を取得
		const defValue = $("#Modal-"+ id).html();
		// 未選択時のメッセージ
		const defValueMsg = "選択してください";
		// 未選択状態の場合
		if(defValue == defValueMsg){
			// class定義のコントロール
			if(!$("#Modal-"+ id).hasClass("reqEntry")){
				$("#Modal-"+ id).addClass("reqEntry").removeClass("inputSelectItem-on data-on");
			}
		// 未選択状態の場合
		}else if(defValue == ""){
			// 表示選択値を合わせる
			$("#Modal-"+ id).add().html("選択してください");
		// 上記以外（選択済）
		}else{
			// class定義のコントロール
			$("#Modal-"+ id).removeClass("reqEntry").addClass("inputSelectItem-on data-on");
		}
	}
	
	/**
	 * ファイルアップロード時共通処理
	 * @args:
	 * uploadElemId…アップロード用の要素(input type="file"の要素）
	 * uploadDispAreaId…アップロードされたファイルを表示するための要素のID
	 * alertAreaId…アップロード時の警告を表示する要素のID
	 * finishMethod…完了時に呼び出される処理
	 * @return:なし
	 */
	function uploadCommon(uploadElemId, uploadDispAreaId, alertAreaId, finishMethod){
		// 警告表示のクリア
		$("#" + alertAreaId).html(null);
		// ファイルアップロード用のInputを取得
		const elemFile = $("#" + uploadElemId).get(0);
		// アップロード対象のファイルを取得
		const files = elemFile.files;
		// アップロードされるファイル数の取得
		selectFiles = files.length;
		// アップロード済のファイル数の取得
		existFiles = $("#" + uploadDispAreaId).children().length;
		// 合計5ファイルを超過している場合
		if(selectFiles + existFiles > 5){
			// 警告表示
			$("#" + alertAreaId).text("ファイル数は5ファイル以内でアップロードしてください。");
			// 完了時の処理を呼び出す
			finishMethod();
			// 以後処理しない
			return;
		}
		// ファイルサイズ
		let fileSize = 0;
		// アップロードファイル分繰り返す
		for(let i = 0; i < files.length; i++){
			// 拡張子で区切る
			const extensionSplit = files[i].name.split(".");
			// 拡張子を取得 ※小文字に変換
			const extension = extensionSplit[extensionSplit.length - 1].toLowerCase();
			// 拡張子が規定のファイルでない場合
			if(extensionList.indexOf(extension) < 0){
				// 警告表示
				$("#" + alertAreaId).html("以下のファイル形式のみアップロード可能です。<BR>画像（.jpg/.jpeg/.png/.heic）書類（.xls/.xlsx/.doc/.docx）、またはPDF形式");
				// 完了時の処理を呼び出す
				finishMethod();
				// 以後処理しない
				return;
			}
			// ファイルサイズを加算
			fileSize = files[i].size;
		}
		// アップロード済のファイルサイズとファイルサイズの合計が24MBを超える場合
		if(uploadedFileSize + fileSize > 24 * 1024 * 1024){
			// 警告表示
			$("#" + alertAreaId).text("ファイルサイズは合計24MB以内でアップロードしてください。");
			// 完了時の処理を呼び出す
			finishMethod();
			// 以後処理しない
			return;
		}
		// アップロード済ファイルサイズにアップロードするファイルサイズを加算する
		uploadedFileSize += fileSize;
		// ファイル表示用テンプレートをロード
		const fileUpTemplate = $("#fileUpTemplate");
		// アップロードファイル分繰り返す
		for(let i = 0; i < files.length; i++){
			// クローンする
			const clone = fileUpTemplate.get(0).content.cloneNode(true);
			// ファイルパスをセパレータ分割
			const filePathList = files[i].name.split("\\");
			// ファイル出力対象のアンカー部分取得
			const anchor = clone.querySelector(".upfile-text").getElementsByTagName("a")[0];
			// ファイル名のみを反映
			anchor.innerHTML = filePathList[filePathList.length - 1];
			// ダウンロード時のファイル名の設定
			anchor.download = filePathList[filePathList.length - 1];
			// 遷移先をダウンロード用に設定
			anchor.href = URL.createObjectURL(files[i]);
			// ファイル名右の×ボタン押下時の処理
			$(clone.querySelector(".inputClear")).on("click", function(){
				// 画面表示位置の取得
				selectFileIndex = $(this.parentNode).prevAll().length;
				// 確認用ダイアログの表示
				$(".modalOverlay,.confirm-uploadfile-delete").fadeIn();
				$("body").css({position:"fixed",top:-1});
			});
			// 画面に反映
			$("#" + uploadDispAreaId).append(clone);
		}
		// 再帰呼び出しによるファイル読み取り
		recursiveFileRead(elemFile, files, 0, finishMethod);
	}
	
	/**
	 * 通信失敗 出力
	 * @args:なし
	 * @return:なし
	 */
	function dispComErrModal(){
		// モーダル表示
		dispErrorModal("error-comError");
	}
	
	/**
	 * 時限チェック 出力
	 * @args:なし
	 * @return:なし
	 */
	function dispTimeoutErrModal(){
		if(errorMessageText){
			$(".eMessage-error-timeoutError").html(errorMessageText);
		}
		// モーダル表示
		dispErrorModal("error-timeoutError");
		// 投稿ボタンを活性化
		$("#inqPost").prop("disabled", false);
		// 確認画面戻るボタンを活性化
		$("#inqPostPrev").prop("disabled", false);
		// 投稿ボタンを活性化
		$("#cbdPost").prop("disabled", false);
		// 確認画面戻るボタンを活性化
		$("#cbdPostPrev").prop("disabled", false);
	}
	
	/**
	 * 通信失敗 出力(登録時)
	 * @args:なし
	 * @return:なし
	 */
	function dispRegisComErrModal(){
		// モーダル表示
		dispErrorModal("error-comErrorRegis");
		// 投稿ボタンを活性化
		$("#inqPost").prop("disabled", false);
		// 確認画面戻るボタンを活性化
		$("#inqPostPrev").prop("disabled", false);
		// 投稿ボタンを活性化
		$("#cbdPost").prop("disabled", false);
		// 確認画面戻るボタンを活性化
		$("#cbdPostPrev").prop("disabled", false);
	}
	
	/**
	 * システムエラー 出力
	 * @args:なし
	 * @return:なし
	 */
	function dispAbnormalErrModal(){
		if(errorMessageText){
			$(".eMessage-error-abnormalError").html(errorMessageText);
		}
		// モーダル表示
		dispErrorModal("error-abnormalError");
		// 投稿ボタンを活性化
		$("#inqPost").prop("disabled", false);
		// 確認画面戻るボタンを活性化
		$("#inqPostPrev").prop("disabled", false);
		// 投稿ボタンを活性化
		$("#cbdPost").prop("disabled", false);
		// 確認画面戻るボタンを活性化
		$("#cbdPostPrev").prop("disabled", false);
	}
	
	/**
	 * メールアドレス不正 出力
	 * @args:なし
	 * @return:なし
	 */
	function dispInvmailErrModal(){
		if(errorMessageText){
			$(".eMessage-error-invmailError").html(errorMessageText);
		}
		// モーダル表示
		dispErrorModal("error-invmailError");
		// 投稿ボタンを活性化
        $("#inqPost").prop("disabled", false);
		// 確認画面戻るボタンを活性化
		$("#inqPostPrev").prop("disabled", false);
	}
	
	/**
	 * 取引先が存在しない(新規問い合わせ登録画面) 出力
	 * @args:なし
	 * @return:なし
	 */
	function dispNoaccErrModal(){
		if(res.result == "NO_ACCOUNT"){
			if(errorMessageText){
				$(".eMessage-error-noaccError").html(errorMessageText);
			}
			// モーダル表示
			dispErrorModal("error-noaccError");
		}
	}
	
	/**
	 * モーダル表示共通
	 * @args:
	 * modalClassName:表示するモーダルのクラス名
	 * @return:なし
	 */
	function dispErrorModal(modalClassName){
		// 処理中表示を隠す
		hideProgress();
		const CurrentScrollY = $(window).scrollTop();
		$(".modalOverlay,." + modalClassName).fadeIn();
		$("." + modalClassName).css("display", "block");
		$("body").css({position:"fixed",top:-1 * CurrentScrollY});
	}
	/**
	 * 処理中表示を出す
	 */
	function dispProgress(){
		$(".progress").fadeIn();
		$("body").css({position:"fixed", top:-1});
	}
	/**
	 * 処理中表示を隠す
	 */
	function hideProgress(){
		$(".progress").fadeOut();
		$("body").css({position:"", top:0});
	}
	
	/**
	 * スクロールトップ共通
	 * @args:なし
	 * @return:なし
	 */
	function dispScrollTop(){
		$("html,body").scrollTop(0);
	}
//-->
</script>

<!--title-->
<div id="title" style="display:none;">
	<div class="titleL"><h1>お問い合わせフォーム</h1></div>
</div>

<!-- InquiryForm -->
<div id="inquiryForm" class="contents" style="display:none;">
	<div class="blk">
		<div class="blkCont bdrT0">
			<div class="note">
				<p>お問い合わせの回答目安は原則、翌営業日です。</p>
			</div>
			<p class="txtR mt-16">
				<a id="newInq" href="javascript:void(0)" onclick="changeDisp('inqInputScreen')" class="btn btn02">新規お問い合わせ</a>
			</p>
			<div class="list-qa">
				<dl id="listQa"></dl>
			</div>
			<p>
				<a href="javascript:commonSubmit('ln0001')" title="Welcome Pageに戻る" class="btn btn02 btnL">Welcome Page</a>
			</p>
		</div>
	</div>
</div>

<!-- InquiryFormNoInq -->
<div id="noInq" class="contents contbrd-pt-cont" style="display:none;">
	<div class="blk">
		<div class="blkCont bdrT0">
			<p class="contbrd-formBtn">
				<a href="javascript:void(0);" onclick="changeDisp('inqInputScreen'); dispNoaccErrModal();" class="btn btn02">新規お問い合わせ</a>
			</p>
			<p class="contbrd-formTitle">お問い合わせフォームの使い方</p>
			<div class="stepCont">
				<div class="stepBox">
					<dl>
						<dt>STEP1</dt>
						<dd>
							<div class="img">
								<img src="/commontpl/images/category/contact_img001.png" alt="" width="180" height="192">
							</div>
							<p class="stepTxt">
								［新規お問い合わせ］<br class="smtOnlyBr">より投稿
							</p>
							<p>
								※Visaデビット・ローン・FX・投資信託・外貨預金は対象外です
							</p>
						</dd>
					</dl>
					<dl>
						<dt>STEP2</dt>
						<dd>
							<div class="img">
								<img src="/commontpl/images/category/contact_img002.png" alt="" width="180" height="192">
							</div>
							<p class="stepTxt">
								回答が投稿されたら<br>メールでお知らせ
							</p>
							<p>
								原則、翌営業日に回答します
							</p>
						</dd>
					</dl>
					<dl>
						<dt>STEP3</dt>
						<dd>
							<div class="img">
								<img src="/commontpl/images/category/contact_img003.png" alt="" width="180" height="192">
							</div>
							<p class="stepTxt">
								ログインして回答を確認
							</p>
							<p>
								好きなタイミングで回答を確認できます
							</p>
						</dd>
					</dl>
				</div>
			</div>
			<p>
				<a href="javascript:commonSubmit('ln0001')" title="Welcome Page" class="btn btn02 btnL">Welcome Page</a>
			</p>
		</div>
	</div>
</div>

<!-- DetailsScreen -->
<div id="detailsScreen" style="display:none;">
	<div class="contents no-title-h1 contbrd-pt-cont">
		<div class="blk">
			<div class="blkCont bdrT0">
				<p id="contbrdTitle" class="contbrd-title"></p>
				<div id="outputCbdTemp" class="contbrd-wrap"></div>
			</div>
		</div>
		<div class="contents">
			<div class="blk">
				<div class="blkCont bdrT0 contbrd-btnArea-box">
					<p>
						<a id="replyButton" href="javascript:void(0);" onclick="changeDisp('replyInputScreen'); dispScrollTop();" title="投稿する" class="btn btn01 btnL">投稿する</a>
					</p>
					<p class="mt-16">
						<input type="button" id="detailPrevButton" onclick="prevDetail();" class="btn btn03 btnL" value="戻る">
					</p>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- NewInquiry_InputScreen -->
<div id="inqInputScreen" class="contents no-title-h1" style="display:none;">
	<div class="blk">
		<div class="blkCont layout-form layout-form-normal">
			<div id="modalText">
				<p class="input-title">お問い合わせ種類</p>
				<p class="inputSelectWrap pulldown">
					<a href="javascript:void(0);" id="Modal-inqType" class="ModalBtn reqEntry">選択してください</a>
				</p>
				<div class="modalWrap pulldown modalWrap-inqType">
					<div class="modalOuter">
						<div class="modal__headArea">お問い合わせ種類</div>
						<div class="modal__bodyArea">
							<ul id="inqType" class="wrap-label-list">
								<li id="dialPrivRegistrationChange" name="inqType">
									<label class="label-radio" for="inqTypePrivRegistrationChange">
										<input type="radio" name="inqType" value="PrivRegistrationChange" id="inqTypePrivRegistrationChange" class="x-data-inqType">
										<span>①登録情報の変更</span>
									</label>
								</li>
								<li id="dialPrivToken" name="inqType">
									<label class="label-radio" for="inqTypePrivToken">
										<input type="radio" name="inqType" value="PrivateToken" id="inqTypePrivToken" class="x-data-inqType">
										<span>②キャッシュカード・トークン</span>
									</label>
								</li>
								<li id="dialPrivTransfer" name="inqType">
									<label class="label-radio" for="inqTypePrivTransfer">
										<input type="radio" name="inqType" value="PrivTransfer" id="inqTypePrivTransfer" class="x-data-inqType">
										<span>③振込</span>
									</label>
								</li>
								<li id="dialPrivAutomaticBankTransfer" name="inqType">
									<label class="label-radio" for="inqTypePrivAutomaticBankTransfer">
										<input type="radio" name="inqType" value="PrivAutomaticBankTransfer" id="inqTypePrivAutomaticBankTransfer" class="x-data-inqType">
										<span>④口座自動振替</span>
									</label>
								</li>
								<li id="dialPrivCertificates" name="inqType">
									<label class="label-radio" for="inqTypePrivCertificates">
										<input type="radio" name="inqType" value="PrivCertificates" id="inqTypePrivCertificates" class="x-data-inqType">
										<span>⑤各種証明書（取引明細・残高証明など）</span>
									</label>
								</li>
								<li id="dialPrivOther" name="inqType">
									<label class="label-radio" for="inqTypePrivOther">
										<input type="radio" name="inqType" value="PrivOther" id="inqTypePrivOther" class="x-data-inqType">
										<span>⑥その他</span>
									</label>
								</li>
								<li id="dialCorpRegistrationChange" name="inqType">
									<label class="label-radio" for="inqTypeCorpRegistrationChange">
										<input type="radio" name="inqType" value="CorpRegistrationChange" id="inqTypeCorpRegistrationChange" class="x-data-inqType">
										<span>①登録情報の変更</span>
									</label>
								</li>
								<li id="dialCorpToken" name="inqType">
									<label class="label-radio" for="inqTypeCorpToken">
										<input type="radio" name="inqType" value="CorpToken" id="inqTypeCorpToken" class="x-data-inqType">
										<span>②キャッシュカード・トークン</span>
									</label>
								</li>
								<li id="dialCorpTransfer" name="inqType">
									<label class="label-radio" for="inqTypeCorpTransfer">
										<input type="radio" name="inqType" value="CorpTransfer" id="inqTypeCorpTransfer" class="x-data-inqType">
										<span>③振込</span>
									</label>
								</li>
								<li id="dialCorpAutomaticBankTransfer" name="inqType">
									<label class="label-radio" for="inqTypeCorpAutomaticBankTransfer">
										<input type="radio" name="inqType" value="CorpAutomaticBankTransfer" id="inqTypeCorpAutomaticBankTransfer" class="x-data-inqType">
										<span>④口座自動振替</span>
									</label>
								</li>
								<li id="dialCorpCertificates" name="inqType">
									<label class="label-radio" for="inqTypeCorpCertificates">
										<input type="radio" name="inqType" value="CorpCertificates" id="inqTypeCorpCertificates" class="x-data-inqType">
										<span>⑤各種証明書（取引明細・残高証明など）</span>
									</label>
								</li>
								<li id="dialCorpBA-PLUS" name="inqType">
									<label class="label-radio" for="inqTypeCorpBA-PLUS">
										<input type="radio" name="inqType" value="CorpBA-PLUS" id="inqTypeCorpBA-PLUS" class="x-data-inqType">
										<span>⑥BA-PLUS</span>
									</label>
								</li>
								<li id="dialCorpOther" name="inqType">
									<label class="label-radio" for="inqTypeCorpOther">
										<input type="radio" name="inqType" value="CorpOther" id="inqTypeCorpOther" class="x-data-inqType">
										<span>⑦その他</span>
									</label>
								</li>
							</ul>
						</div>
						<p>
							<a href="javascript:void(0);" class="modal__bottomArea btn btn03 btnL">閉じる</a>
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="blkCont layout-form layout-form-normal">
			<div class="input-textarea">
				<label for="textInput" class="input-title">お問い合わせ詳細</label>
				<div class="textinput-box">
					<textarea type="text" id="inqTextInput" name="textInput" maxlength="2000" rows="10" wrap="soft" class="reqEntry" placeholder="ご記入ください" style="overflow: auto;"></textarea>
					<span id="inqContentDel" class="inputClear" style="margin-right: 16px;">×</span>
				</div>
				<span class="input-message">2000文字以内で入力</span>
				<div id="inqOutputError" style="color:#FF0033;"></div>
			</div>
		</div>
		<div class="blkCont layout-form layout-form-normal">
			<div>
				<p class="input-title">メールアドレス</p>
				<p id="newInqMail"></p>
			</div>
		</div>
		<div class="blkCont mt-16">
			<div class="note">
				<p>当社からの回答がお問い合わせフォームに投稿されると、上記の登録メールアドレス宛にお知らせします。回答内容はお問い合わせフォームにログインしてご確認ください。</p>
			</div>
		</div>
		<div class="blkCont layout-form layout-form-normal">
			<div class="wrap-input upfile-wrap">
				<label class="input-title">ファイルアップロード（任意）
					<span class="upfileLink">ファイルを選択（24MBまで）</span>
					<input type="file" name="fileName" id="inqFileName" class="dn" multiple="multiple">
				</label>
				<div id="inqFileAlert" style="font-weight:bold;color:red;"></div>
				<div id="inqFileList"></div>
			</div>
		</div>
		<div class="modalWrap_error confirm-back">
			<div class="modalOuter_error">
				<div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
				<div class="modal__bodyArea">
					<p class="fBold">入力された内容が失われます。<br>それでも問題ない場合は戻るを選択して下さい。</p>
				</div>
				<div class="modal_error_btnArea">
					<p><a href="javascript:void(0);" class="btn btn01 btnL modal__close" onclick="inqClearInput();sendHome();">戻る</a></p>
					<p><a href="javascript:void(0);" class="btn btn03 btnL modal__close">閉じる</a></p>
				</div>
			</div>
		</div>
		<div class="modalWrap_error confirm-clear">
			<div class="modalOuter_error">
				<div class="modal__headArea">
					<img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64">
				</div>
				<div class="modal__bodyArea">
					<p class="fBold">入力された内容が失われます。<br>それでも問題ない場合は「削除する」を選択してください。</p>
				</div>
				<div class="modal_error_btnArea">
					<p><a id="inqDelBtn" href="javascript:void(0);" class="btn btn01 btnL modal__close">削除する</a></p>
					<p><a href="javascript:void(0);" class="btn btn03 btnL modal__close">閉じる</a></p>
				</div>
			</div>
		</div>
		<div class="modalWrap_error confirm-uploadfile-delete">
			<div class="modalOuter_error">
				<div class="modal__headArea">
					<img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64">
				</div>
				<div class="modal__bodyArea">
					<p class="fBold">アップロードしたファイルが削除されます。<br>それでも問題ない場合は「削除する」を選択してください。</p>
				</div>
				<div class="modal_error_btnArea">
					<p><a href="javascript:void(0);" class="btn btn01 btnL modal__close" onclick="inqDeleteFile();">削除する</a></p>
					<p><a href="javascript:void(0);" class="btn btn03 btnL modal__close">閉じる</a></p>
				</div>
			</div>
		</div>
		<div class="blkCont contbrd-btnArea-box">
			<p>
				<input type="button" id="inqConfButton" onclick="outputValueInqConf();" class="btn btn01 btnL" value="確認する" disabled>
			</p>
			<p class="mt-16">
				<input type="button" id="inqPrevButton" onclick="inqPrevAction();" class="btn btn03 btnL prevBtn" value="戻る">
			</p>
		</div>
	</div>
</div>

<!-- NewInquiry_ConfirmationScreen -->
<div id="inqConfirmScreen" class="contents no-title-h1" style="display:none;">
	<div class="blk">
		<div class="blkTitle">
			<h2 id="inqConfType" class="h201">お問い合わせ種類</h2>
		</div>
		<div class="blkCont bdrT0">
			<p id="inqConfTypeText"></p>
			<div id="inqTypeOutputError" class="mt-16 caution" style="display:none;">ブラウザの翻訳機能を使用したため、投稿できない文字が表示されています。翻訳機能をオフにして、［戻る］からもう一度やり直してください。</div>
		</div>
		<div class="blkTitle">
			<h2 id="inqConfDtails" class="h201">お問い合わせ詳細</h2>
		</div>
		<div class="blkCont bdrT0">
			<p id="inqConfDtailsText"></p>
		</div>
		<div class="blkTitle">
			<h2 class="h201">メールアドレス</h2>
		</div>
		<div class="blkCont bdrT0">
			<p id="inqConfMailText"></p>
		</div>
		<div class="blkTitle">
			<h2 class="h201">ファイルアップロード</h2>
		</div>
		<div class="blkCont bdrT0">
			<p id="inqUploadFiles"></p>
		</div>
		<div class="blkCont bdrT0">
			<div class="contbrd-btnArea-box">
				<p>
					<input type="button" id="inqPost" onclick="registInquery();" class="btn btn01 btnL" value="投稿する">
				</p>
				<p class="mt-16">
					<input type="button" id="inqPostPrev" onclick="changeDisp('inqInputScreen'); dispScrollTop();" class="btn btn03 btnL" value="戻る">
				</p>
			</div>
		</div>
	</div>
</div>

<!-- Reply_InputScreen -->
<div id="replyInputScreen" class="contents no-title-h1 contbrd-pt-cont" style="display:none;">
	<div class="blk">
		<div class="blkCont layout-form layout-form-normal">
			<p class="contbrd-title">投稿内容</p>
			<div class="input-textarea">
				<div class="textinput-box">
					<textarea type="text" id="cbdTextInput" name="textInput" maxlength="2000" rows="10" wrap="soft" class="reqEntry inputTextItem" placeholder="ご記入ください" style="overflow: auto;"></textarea>
					<span id="cbdContentDel" class="inputClear" style="margin-right: 16px;">×</span>
				</div>
				<span class="input-message">2000文字以内で入力</span>
				<div id="cbdOutputError" style="color:#FF0033;"></div>
			</div>
			<div class="blkCont layout-form layout-form-normal">
				<div class="mt-16">
					<div class="wrap-input upfile-wrap">
						<label class="input-title">ファイルアップロード（任意）
							<span class="upfileLink">ファイルを選択（24MBまで）</span>
							<input type="file" name="fileName" id="cbdFileName" class="dn" multiple="multiple">
						</label>
						<div id="cbdFileAlert" style="font-weight:bold;color:red;"></div>
						<div id="cbdFileList"></div>
					</div>
				</div>
				<div class="modalWrap_error confirm-back">
					<div class="modalOuter_error">
						<div class="modal__headArea">
							<img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64">
						</div>
						<div class="modal__bodyArea">
							<p class="fBold">入力された内容が失われます。<br>それでも問題ない場合は戻るを選択してください。</p>
						</div>
						<div class="modal_error_btnArea">
							<p><a href="javascript:void(0);" class="btn btn01 btnL modal__close" onclick="cbdClearInput();">戻る</a></p>
							<p><a href="javascript:void(0);" class="btn btn03 btnL modal__close">閉じる</a></p>
						</div>
					</div>
				</div>
				<div class="modalWrap_error confirm-clear">
					<div class="modalOuter_error">
						<div class="modal__headArea">
							<img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64">
						</div>
						<div class="modal__bodyArea">
							<p class="fBold">入力された内容が失われます。<br>それでも問題ない場合は「削除する」を選択してください。</p>
						</div>
						<div class="modal_error_btnArea">
							<p><a id="cbdDelBtn" href="javascript:void(0);" class="btn btn01 btnL modal__close">削除する</a></p>
							<p><a href="javascript:void(0);" class="btn btn03 btnL modal__close">閉じる</a></p>
						</div>
					</div>
				</div>
				<div class="modalWrap_error confirm-uploadfile-delete">
					<div class="modalOuter_error">
						<div class="modal__headArea">
							<img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64">
						</div>
						<div class="modal__bodyArea">
							<p class="fBold">アップロードしたファイルが削除されます。<br>それでも問題ない場合は「削除する」を選択してください。</p>
						</div>
						<div class="modal_error_btnArea">
							<p><a href="javascript:void(0);" class="btn btn01 btnL modal__close" onclick="cbdDeleteFile();">削除する</a></p>
							<p><a href="javascript:void(0);" class="btn btn03 btnL modal__close">閉じる</a></p>
						</div>
					</div>
				</div>
				<div class="contbrd-btnArea-box">
					<p class="mt-24">
						<input type="button" id='cbdConfButton' onclick="outputValueCbdConf();" class="btn btn01 btnL" value="確認する" disabled>
					</p>
					<p class="mt-16">
						<input type="button" id='cbdPrevButton' onclick="cbdPrevAction();" class="btn btn03 btnL PrevBtn" value="戻る">
					</p>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Reply_ConfirmationScreen -->
<div id="replyConfirmScreen" class="contents no-title-h1 contbrd-pt-cont" style="display:none;">
	<div class="blk">
		<div class="blkCont bdrT0">
			<p class="contbrd-title">投稿内容</p>
			<p id="cbdConfDtailsText"></p>
			<h3 class="h301 mt-24">ファイルアップロード</h3>
			<p id="cbdUploadFiles"></p>
			<div class="contbrd-btnArea-box">
				<p>
					<input type="button" id="cbdPost" onclick="registContactBoard();" class="btn btn01 btnL" value="投稿する">
				</p>
				<p class="mt-16">
					<input type="button" id="cbdPostPrev" onclick="changeDisp('replyInputScreen'); dispScrollTop();" class="btn btn03 btnL" value="戻る">
				</p>
			</div>
		</div>
	</div>
</div>

<!-- CompletionScreen -->
<div id="compScreen" class="contents no-title-h1 contbrd-pt-cont" style="display:none;">
	<div class="blk">
		<div class="blkCont">
			<p class="compDescription">
				<span class="compDescriptionIcon">受付完了しました</span>
			</p>
		</div>
		<div class="blkCont mt-24">
			<p>受付完了のメールを送信しました。</p>
			<p class="faqLink">
				<a href="https://help.paypay-bank.co.jp/hc/ja/articles/900002658186" target="_blank">メールが届かない場合</a>
			</p>
			<p>当社からの回答は原則翌営業日にメールでお知らせします。回答内容はお問い合わせフォームにログインしてご確認ください。</p>
			<div class="contbrd-btnArea-box">
				<p>
					<input type="submit" id="" onclick="getAllCaseWithoutAuth(); changeDisp('inquiryForm')" class="btn btn02 btnL" value="お問い合わせフォーム">
				</p>
				<p class="mt-16">
					<input type="submit" class="btn btn03 btnL" value="Welcome Page" onclick="commonSubmit('ln0001');">
				</p>
			</div>
		</div>
	</div>
</div>

<!-- errorScreen -->
<div id="errorScreen" class="contents no-title-h1 no-logout-btn" style="display:none;>
	<div class="blk">
		<div class="blkCont txtC">
			<p id="errorDateTime" class="mt-16 h301"></p>
			<p class="mt-16">予期しないエラーが発生しました。<br>恐れ入りますが、再ログインしてください。</p>
			<p class="mt-24"><a href="/wctx/LoginAction.do?screen=Contactboard" class="btn btn01 btnL">ログイン</a></p>
			<p class="mt-24">※回線の混雑状況や通信環境などによりこの画面が表示される場合があります。</p>
			<p>※再ログインの際に、上書きログインのエラーが表示される場合があります。</p>
			<p>※再ログインしてもこの画面が表示される場合は、時間を置いてから、あらためてログインしてください。</p>
		</div>
	</div>
</div>

<div class="modalOverlay"></div>

<!-- 通信失敗 -->
<div class="modalWrap_error error-comError">
    <div class="modalOuter_error">
        <div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
        <div class="modal__bodyArea">
            <p class="fBold eMessage-comError">通信エラーが発生しました。<br>時間をおいて、再度お試しください。</p>
        </div>
        <div class="modal_error_btnArea">
            <p><a href="javascript:void(0);" class="btn btn03 btnL mClose">閉じる</a></p>
        </div>
    </div>
</div>

<!-- 時限チェック -->
<div class="modalWrap_error error-timeoutError">
    <div class="modalOuter_error">
        <div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
        <div class="modal__bodyArea">
            <p class="fBold eMessage-error-timeoutError"></p>
        </div>
        <div class="modal_error_btnArea">
            <p><a href="javascript:void(0);" class="btn btn03 btnL mClose">閉じる</a></p>
        </div>
    </div>
</div>

<!-- 異常終了 -->
<div class="modalWrap_error error-abnormalError">
    <div class="modalOuter_error">
        <div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
        <div class="modal__bodyArea">
            <p class="fBold eMessage-error-abnormalError"></p>
        </div>
        <div class="modal_error_btnArea">
            <p><a href="javascript:void(0);" class="btn btn03 btnL mClose">閉じる</a></p>
        </div>
    </div>
</div>


<!-- 通信失敗(登録時) -->
<div class="modalWrap_error error-comErrorRegis">
    <div class="modalOuter_error">
        <div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
        <div class="modal__bodyArea">
            <p class="fBold eMessage-error-comErrorRegis">通信エラーが発生しました。<br>入力内容が消えてしまうため、<br>入力内容をお控えいただき、<br>時間をおいて、再度お試しください。</p>
        </div>
        <div class="modal_error_btnArea">
            <p><a href="javascript:void(0);" class="btn btn03 btnL mClose">閉じる</a></p>
        </div>
    </div>
</div>

<!-- メールアドレス不正 -->
<div class="modalWrap_error error-invmailError">
    <div class="modalOuter_error">
        <div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
        <div class="modal__bodyArea">
            <p class="fBold eMessage-error-invmailError"></p>
        </div>
        <div class="modal_error_btnArea">
            <p><a href="javascript:void(0);" class="btn btn03 btnL mClose">閉じる</a></p>
        </div>
    </div>
</div>

<!-- 取引先が存在しない -->
<div class="modalWrap_error error-noaccError">
    <div class="modalOuter_error">
        <div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
        <div class="modal__bodyArea">
            <p class="fBold eMessage-error-noaccError"></p>
        </div>
        <div class="modal_error_btnArea">
            <p><a href="javascript:void(0);" class="btn btn03 btnL mClose" onclick="changeDisp('noInq')">閉じる</a></p>
        </div>
    </div>
</div>
<!-- 確認ダイアログ（ブラウザバック用） -->
<div class="modalWrap_error confirm-historyBack">
	<div class="modalOuter_error">
		<div class="modal__headArea"><img src="/commontpl/images/category/contact_error.png" alt="" width="128" height="64"></div>
		<div class="modal__bodyArea">
			<p class="fBold">入力された内容が失われます。<br>それでも問題ない場合は戻るを選択して下さい。</p>
		</div>
		<div class="modal_error_btnArea">
			<p><a href="javascript:void(0);" class="btn btn01 btnL modal__close" onclick="sendHome();">戻る</a></p>
			<p><a href="javascript:void(0);" class="btn btn03 btnL modal__close" onclick="pushHistory();">閉じる</a></p>
		</div>
	</div>
</div>
<!-- 読み込み中 -->
<div class="modalWrap_error progress" style="background-color:rgba(0,0,0,0);">
	<div class="modalOuter_error" style="background-color:rgba(0,0,0,0);">
		<div class="modal__headArea" style="background-color:rgba(0,0,0,0);"><img src="/commontpl/images/category/account_opening_loading001.gif" alt=""></div>
	</div>
</div>
